/*!
 * vue-router-cache.js v0.0.2
 * (c) 2019-2019 kallsave
 * Released under the MIT License.
 */
/*!
 * vue-router-cache.js v0.0.2
 * (c) 2019-2019 kallsave
 * Released under the MIT License.
 */
var e,t;e=this,t=function(){"use strict";var e=function(){},t={max:1/0,directionKey:"direction",isSingleMode:!0,isDebugger:!1,getHistoryStack:e,setHistoryStack:e};function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;r(this,e),this.max=t,this.init()}return o(e,[{key:"init",value:function(){this.list=[]}},{key:"_pop",value:function(e){return this.list.unshift(e),this.list.length>this.max?this.list.pop():null}},{key:"pop",value:function(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t],n=this._pop(r);n&&e.push(n)}return e}},{key:"shift",value:function(){return this.list.length?this.list.shift():null}},{key:"_remove",value:function(e){var t=this.list.indexOf(e);return-1!==t?this.list.splice(t,1)[0]:null}},{key:"remove",value:function(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t],n=this._remove(r);n&&e.push(n)}return e}},{key:"removeByIndex",value:function(e){return this.list[e]?this.list.splice(e,1)[0]:null}},{key:"removeBackUntil",value:function(e){var t=this.list.indexOf(e);return-1!==t?this.list.splice(0,t):this.list.splice(0)}},{key:"removeBackInclue",value:function(e){var t=this.list.indexOf(e);return-1!==t?this.list.splice(0,t+1):this.list.splice(0)}},{key:"removeBackByIndex",value:function(e){return e<=this.list.length-1?this.list.splice(0,e):this.list.splice(0)}},{key:"removeExclude",value:function(){for(var e=[],t=0;t<this.list.length;t++){var r=this.list[t];if(-1===Array.prototype.indexOf.call(arguments,r)){var n=this.list.splice(t,1)[0];Array.prototype.push.call(e,n),t--}}return e}},{key:"removeAll",value:function(){return this.list.splice(0)}},{key:"replace",value:function(e){var t=this.shift();return t?(this._pop(e),t):null}},{key:"getHeader",value:function(){return this.list[0]}},{key:"getByIndex",value:function(e){return this.list[e]}},{key:"getFooter",value:function(){return this.list[this.list.length-1]}},{key:"getSize",value:function(){return this.list.length}},{key:"getStore",value:function(){return this.list}},{key:"getMax",value:function(){return this.max}},{key:"has",value:function(e){return-1!==this.list.indexOf(e)}},{key:"updateSize",value:function(e){this.max=e}},{key:"checkFull",value:function(){return this.max===this.list.length}}]),e}(),l=function(e){function t(){return r(this,t),c(this,i(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,e),o(t,[{key:"_pop",value:function(e){var t=this.list.indexOf(e);return-1!==t&&this.list.splice(t,1),this.list.unshift(e),this.list.length>this.max?this.list.pop():null}}]),t}(s);function u(e,t,r,n){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){e!==r&&(r=e,"function"==typeof n&&n(e))}})}var h=new l(t.max),f=[],v=Object.create(null);u(t,"max",t.max,(function(e){h.updateSize(e)}));var m={resolveKeyFromRoute:function(e){return e.name?e.name:e.path},resolveKeyFromLocation:function(e){var r=t.router.resolve(e).route;return this.resolveKeyFromRoute(r)},removeGlobalCacheFromItem:function(e){for(var t=0;t<f.length;t++){var r=f[t].cache;r[e]&&(r[e].componentInstance.$destroy(),r[e]=null)}},removeGlobalCacheFromList:function(e){for(var t=0;t<e.length;t++){var r=e[t];this.removeGlobalCacheFromItem(r)}},shift:function(){var e=h.shift();e&&this.removeGlobalCacheFromItem(e)},_remove:function(e){var t=h.remove(e);t.length&&this.removeGlobalCacheFromList(t)},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],r=this.resolveKeyFromLocation(t);this._remove(r)}},_removeBackUntil:function(e){var t=h.removeBackUntil(e);t.length&&this.removeGlobalCacheFromList(t)},removeBackUntil:function(e){var t=this.resolveKeyFromLocation(e);this._removeBackUntil(t)},_removeBackInclue:function(e){var t=h.removeBackInclue(e);t.length&&this.removeGlobalCacheFromList(t)},removeBackInclue:function(e){var t=this.resolveKeyFromLocation(e);this._removeBackInclue(t)},removeBackByIndex:function(e){var t=h.removeBackByIndex(e);t.length&&this.removeGlobalCacheFromList(t)},_removeExclude:function(){var e=h.removeExclude.apply(h,arguments);e.length&&this.removeGlobalCacheFromList(e)},removeExclude:function(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t],n=this.resolveKeyFromLocation(r);e.push(n)}this._removeExclude.apply(this,e)},removeAll:function(){var e=h.removeAll();e.length&&this.removeGlobalCacheFromList(e)},getStore:function(){return{cache:f,stack:h.getStore()}},has:function(e){var t=this.resolveKeyFromLocation(e);return h.has(t)}},p=function(){function e(){r(this,e),this.map={}}return o(e,[{key:"on",value:function(e,t){this.map[e]?this.map[e].push(t):this.map[e]=[t]}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.map[e]&&this.map[e].forEach((function(e){e.apply(void 0,r)}))}}]),e}(),y=new s;u(t,"getHistoryStack",t.max,(function(e){var t=e();if(t)for(var r=t.length-1;r>-1;r--){var n=t[r];y.pop(n)}}));var g=new p;function d(e){return null!=e}window.addEventListener("hashchange",(function(){y.getByIndex(1)===window.location.href?g.emit("back"):g.emit("forward")}));var k={name:"router-cache",abstract:!0,created:function(){this.cache=Object.create(null),f.push({cache:this.cache})},render:function(e){var r=this.$slots.default,n=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t];if(d(r)&&(d(r.componentOptions)||(n=r).isComment&&n.asyncFactory))return r}var n}(r);if(n){var o;if(t.isSingleMode)o=m.resolveKeyFromRoute(this.$route);else{var i=m.resolveKeyFromRoute(this.$route);v[i]||(v[i]=new l),"back"!==this.$route.params[t.directionKey]?(o="".concat(i,"_").concat(v[i].getSize()),v[i].pop(o)):o=v[i].getByIndex(0)}if(this.cache[o])n.componentInstance=this.cache[o].componentInstance,t.isDebugger&&console.log("using cache key: %c".concat(o),"color: orange");else if(h.checkFull()){var a=h.getFooter();m._remove(a),this.cache[o]=n}else this.cache[o]=n;h.pop(o),n.data.keepAlive=!0}return t.isDebugger&&console.log("all cache key: %c".concat(JSON.stringify(h.getStore())),"color: orange"),n||r&&r[0]},beforeDestroy:function(){for(var e in this.cache)m._remove(e);for(var t,r=0;r<f.length;r++)if(this.cache===f[r]){t=r;break}f.splice(t,1)}},b="";g.on("back",(function(){b="back",y.shift(),t.setHistoryStack(y.getStore());var e=t.router.history.current;if(t.isSingleMode){var r=m.resolveKeyFromRoute(e);m._remove(r)}else{var n=m.resolveKeyFromRoute(e);if(v[n]){var o=v[n].shift();m._remove(o)}}})),g.on("forward",(function(){b="forward"}));var x=function(e,t){var r=t.router,n=t.directionKey,o=r.push.bind(r),i=r.replace.bind(r),a=r.go.bind(r);r.push=function(e,r,n){t.isSingleMode&&m.has(e)&&m.removeBackInclue(e),o(e,r,n)},r.replace=function(e,r,n){b="replace",y.shift(),t.setHistoryStack(y.getStore()),m.shift(),t.isSingleMode&&m.has(e)&&m.removeBackInclue(e),i(e,r,n)},r.go=function(e){e>0?b="forward":e<-1&&(b="back",y.removeBackByIndex(-e),t.setHistoryStack(y.getStore()),m.removeBackByIndex(-e)),a(e)},r.beforeEach((function(e,t,r){window.setTimeout((function(){e.params[n]=b,r()}),0)})),u(r.history,"current",r.history.current,(function(){e.nextTick((function(){var e=window.location.href;"back"!==b&&y.getHeader()!==e&&(y.pop(e),t.setHistoryStack(y.getStore())),b="forward"}))}))},F=!1;return{install:function(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.router?!n.max||(r=n.max)===1/0||"number"==typeof r&&r>0&&(0|r)===r?F||(F=!0,Object.assign(t,n),e.prototype.$routerCache=m,e.component(k.name,k),x(e,t)):console.error("parameter %cmax","color: orange","must be an integer"):console.error("parameter %crouter","color: orange","is required")},routerCache:m,version:"0.0.2"}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueRouterCache=t();